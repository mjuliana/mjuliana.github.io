---
title: "Cross-Region, Multi-Master Database... Well, Sort Of"
date: 2022-05-30
---

Scalability, one of my favorite "_ilities_", is a necessity when it comes to modern applications. You never know when you are going to need additional capacity at a moment's notice. Scalability is a primary benefit of the cloud. AWS offers many options for scaling core services such as compute, storage and database. Some may argue that the data **is** the application, so it should be the top consideration when designing for scalability. However, as is the case for many application designs, the database tends to be a scalability bottleneck. Why is that? Well, since the database is the single source of truth for the application, there should only be one copy of it. This is the primary cause for the database being a scalability bottleneck.

Depending on the application usage patterns, if there are more read operations than there are write operations, it is feasible to add additional copies of the data for reads. This provides scalability at the data layer without impacting data integrity. Read replicas are the primary way to horizontally scale your databases. With more and more applications having a global user base, the need to have data globally distributed is fast becoming a core requirement. [Amazon RDS](https://aws.amazon.com/rds/) provides cross region read replicas. This feature ensures that the data is as close to the end user as possible, helping to ensure both performance and scalability. This is all well and good for read heavy workloads, but what about when you need increased write capacity for your databases?

There are two primary scaling mechanisms that you can use. We already talked about horizontal scaling. This is where you have to add more copies of the same data (read replicas) so that it is readily available to everyone that needs it. The other option is to scale vertically. Vertical scaling is increasing the capacity of a single database server. Horizontal = adding more. Vertical = making bigger. So when you need more write capacity for your database you have these two options.

**NOTE:** _The scope of this post is basic database scalability options and does not include other scalability solutions, such as caching and queueing. We'll explore those another time._

As we have already said, in order to maintain data integrity, it's best to only have one copy of the data that changes. This would lead you to utilize vertical scaling for increasing database write capacity. This is typically the chosen approach, but we need to consider the finite limits of a single database instance. Sure, you can configure a pretty beefy database instance in the cloud, but you also need to weigh other factors such as cost and reliability. So horizontal scaling is also an option, however, it comes with a whole new set of challenges.

With horizontal scaling data integrity becomes a concern since you essentially have 2 mutable copies of the single source of truth. Now, I'm not greatest at math but even I can tell that having two of something that can be independently changed both being considered the single source of truth can be problematic. Fortunately, Amazon Aurora has made it easy to work with [multi-master database clusters](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/aurora-multi-master.html#aurora-multi-master-overview). This is a great option when you need to scale your read capacity. Amazon Aurora multi-master database clusters are unfortunately not available cross region. We have already explored the need to scale your application globally, so what are the options for this scenario?

[Amazon Aurora Global Database](https://aws.amazon.com/rds/aurora/global-database/) provides cross region read replicas utilizing a dedicated global network in order to reduce latency to less than 1 second. This ensures that no matter where your user is located, they will always have a fresh copy of the data. Now I know what you're thinking, you're saying "how does this help with the write heavy, cross-region, multi-master database workloads we've been talking about?" Well, we're about to get to that. First, let's explore some of the challenges of cross-region applications. With a cross-region application, you are going to have a copy of the application tier and preferably a database read replica in a secondary region. If the secondary region is read-only then you're all set. However, if the secondary region is also write heavy then we have a challenge. The application in the secondary region will need to be able to differentiate between read and write operations. This means that write operations will need to connect back to the primary node of the cluster in the primary region. This can get complicated. Two connection strings. Additional application logic. Exception handling. Latency. Sounds like a pain. If only there were a better way.

[Amazon Aurora global database with write forwarding](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/aurora-global-database-write-forwarding.html) to the rescue. With write forwarding, you can use the secondary region cluster endpoint for both read _and_ write operations, thus eliminating the need for separate read and write connections. Although the write operations are still going back to the primary read/write node of the cluster in the primary region, this is a managed operation by Aurora, which makes it seamless for you. Remember the private, dedicated, low-latency replication network that Aurora global database uses? That is utilized for this feature too, so it is performant as well. Additionally, you have control over the read consistency of the database in the secondary region at the session level, giving you added flexibility based on your use case needs. While this is not true cross-region multi-master, it effectively operates as such. As with all good things, there are some limitations but for a majority of use cases, Amazon Aurora global database with write forwarding is your cross-region, multi-master database solution... well, sort of.